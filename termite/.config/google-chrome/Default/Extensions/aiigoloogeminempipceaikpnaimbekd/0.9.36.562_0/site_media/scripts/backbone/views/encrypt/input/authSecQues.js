var AuthSecQuesView=BaseEncryptInputView.extend({defaults:{MAX_SECURITY_ANSWERS:1,MIN_CHARS_ENABLE_CLOSE:16,CLOSE_ANSWER_REGEX:''},events:{"change #securityQuestion":"handleQuestionChange","change #securityAnswer":"handleAnswerChange","change #acceptCloseAnswers":"handleCloseChange","keydown #securityAnswer":"handleAnswerKeyDown","keyup #securityAnswer":"handleAnswerKeyUp","click #showExpireFail":"handleShoeExpireFail"},initialize:function(options){this.options=$.extend({},this.defaults,options);$('#closeAnswersTip > span').text(this.options.MIN_CHARS_ENABLE_CLOSE);_.bindAll(this,['reset']);$(document).bind('formReset',this.reset);this.maxAuthFailsDropDown=$('#maxAuthAttempts').imageDropdown({'selectList':$("#expireFromAuthFails_options"),'initialValue':$("#expireFromAuthFails_options").data('initialValue'),'highlightClass':'li-hover','showSelectedItemInList':true});this.maxAuthFailsDropDown.setSelectedValue(this.model.get('lifeMinutes'));_.bindAll(this,['handleMaxFailsChange']);this.maxAuthFailsDropDown.bind('change',this.handleMaxFailsChange);this.maxAuthFailsDropDown.trigger('change');this.model.bind("validationError",this.handleValidationError);},handleQuestionChange:function(){this.model.set({'securityQuestion':$.trim($('#securityQuestion').val())});},handleAnswerChange:function(){this.model.set({'securityAnswer':$.trim($('#securityAnswer').val())});},handleCloseChange:function(){this.model.set({'acceptCloseAnswers':$('#acceptCloseAnswers').is(":checked")});},handleMaxFailsChange:function(){if(this.maxAuthFailsDropDown.val()=="none"){this.model.set({'maxAuthAttempts':null});}else{this.model.set({'maxAuthAttempts':this.maxAuthFailsDropDown.val()});$('#maxAuthAttempts').find('.selected').append(' '+$('#expireFromAuthFails_options').data('value-suffix'));}},handleAnswerKeyDown:function(event){if($('#securityAnswer').val().split(',').length>=this.options.MAX_SECURITY_ANSWERS&&event.keyCode==188){return false;}},handleAnswerKeyUp:function(){var answers=$('#securityAnswer').val().split(',');var oneIsLongEnough=false;var regex=this.options.CLOSE_ANSWER_REGEX;var min_chars=this.options.MIN_CHARS_ENABLE_CLOSE;$.each(answers,function(i,val){var nonStrippedCharLength=val.replace(regex,'').length;if(nonStrippedCharLength>=min_chars){oneIsLongEnough=true;return false;}});if(oneIsLongEnough){$("#acceptCloseAnswers").removeAttr("disabled");$("#lblCloseAnswer").removeClass("disabled");}
else{$("#acceptCloseAnswers").attr("disabled",true).prop('checked',false);$("#lblCloseAnswer").addClass("disabled");}},reset:function(){$('#securityQuestion').val('');$('#securityAnswer').val('').blur();$('#acceptCloseAnswers').prop('checked',false);$("#acceptCloseAnswers").attr("disabled",true);$("#lblCloseAnswer").addClass("disabled");$("#uniform-acceptCloseAnswers").addClass("disabled");},handleValidationError:function(type,msg){var elem=null;switch(type){case"secQuesBoth":elem=$('#securityQuestion').add('#securityAnswer');break;case"secQues":elem=$('#securityQuestion');break;case"secAns":elem=$('#securityAnswer');break;}
if(elem){AuthSecQuesView.__super__.appendError($("#authOptionQA_errors"),msg,elem);}},handleShoeExpireFail:function(event){$(event.target).hide();$('#defaultAutoValue').hide();$('#expireFromAuthFails_outer').removeClass('defaultHide');}});