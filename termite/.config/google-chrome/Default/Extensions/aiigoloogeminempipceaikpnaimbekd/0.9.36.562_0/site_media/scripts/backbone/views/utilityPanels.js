var UtilityPanelsView=Backbone.View.extend({defaults:{},events:{'click .showLoginPanel':'handleExpressSignIn','click .showPwordPanel':'handleLoginForgotClick','click .showResendPanel':'handleLoginForgotClick','click .showRegisterPanel':'handleExpressRegisterClick','click #loginButton':'handleLoginButtonClick','click #registerButton':'handleRegisterButtonClick','click #resetSubmit':'handleResetButtonClick','click .registerRetry':'handlePageReload'},initialize:function(options){this.options=$.extend({},this.defaults,options||{});$('#loginButton').unbind('click');$('#registerButton').unbind('click');$('#resetSubmit').unbind('click');$('#login_form input').unbind('keyup','return');$('#registration_form input').unbind('keyup','return');$('#reset_password_form input').unbind('keyup','return');var self=this;$('#login_form input').bind('keyup',function(event){if(event.keyCode=='13'){self.handleLoginButtonClick();}});$('#registration_form input').bind('keyup',function(event){if(event.keyCode=='13'){self.handleRegisterButtonClick();}});$('#reset_password_form input').bind('keyup',function(event){if(event.keyCode=='13'){self.handleResetButtonClick();}});this.loginForm=new LoginFormView({el:$('#login_form'),bindSubmitEvent:false});$('#resetSubmit').waitButton({disableButton:false});},handlePageReload:function(e){location.reload();},handleExpressSignIn:function(e){this.options.linksView.handleExpressSignIn(e);},handleExpressRegisterClick:function(e){this.options.linksView.handleExpressRegisterClick(e);},handleLoginForgotClick:function(e){this.options.linksView.handleExpressForgotClick(e);},handleLoginButtonClick:function(event){if($('#login_form .claimLinkCb').is(':checked')){var publicIdField=$('<input type="hidden" name="publicId">');var adminCredHashField=$('<input type="hidden" name="adminCredHash">');publicIdField.attr('value',lockify.index.entry.get('publicId'));adminCredHashField.attr('value',lockify.index.entry.get('cryptoAssets')['adminCredHash']);$('#login_form').append(publicIdField);$('#login_form').append(adminCredHashField);}
this.loginForm.submitLoginForm();},handleRegisterButtonClick:function(event){if(event&&typeof(event.preventDefault)!=='undefined'){event.preventDefault();}
if($('#registration_form .claimLinkCb').is(':checked')){var publicIdField=$('<input type="hidden" name="publicId">');var adminCredHashField=$('<input type="hidden" name="adminCredHash">');publicIdField.attr('value',lockify.index.entry.get('publicId'));adminCredHashField.attr('value',lockify.index.entry.get('cryptoAssets')['adminCredHash']);$('#registration_form').append(publicIdField);$('#registration_form').append(adminCredHashField);}
$('#registration_form').submit();},handleResetButtonClick:function(){$('#reset_password_form').find('input').removeClass('validationError');if(!lockifyUtils.isEmail($('#id_email').val())){$('#resetPasswordError').text('Email not in valid format, e.g. you@domain.com.');$('#resetSubmit').trigger('deanimate');$('#reset_password_form').find('input').addClass('validationError');return false;}
lockifyAjax.ajaxJSONSafeForm("/accounts/password_reset_json/",$('#reset_password_form'),function(json){$('#reset_password_form').hide();$('.submittedEmailAddress').text($('#id_email').val());$('#resetPasswordSubmitted').show();$('#resetSubmit').trigger('deanimate');if($("#expressUtilityPanels").is(":visible")){$("#expressUtilityPanels .dialogFooter").hide();$("#expressUtilityPanels .dialogContent").addClass("footerless");$(".dynamicText").text($('.dynamicText').data('checkemail'));}},function(json){$('#resetSubmit').trigger('deanimate');$('#reset_password_form').find('input').addClass('validationError');});return false;},handleRegisterRetry:function(){$('#registrationSubmitted').hide();$('.claimLinkRegister').hide();$('#registration_form').show();$('.dynamicText').html($('.dynamicText').data('register'));},handlePwordRetry:function(){$('#resetPasswordSubmitted').hide();$('#reset_password_form').show();$('.dynamicText').text($('.dynamicText').data('passwordreset'));},reset:function(){}});