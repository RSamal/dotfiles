var FileListView=Backbone.View.extend({defaults:{},events:{},initialize:function(){_.bindAll(this,['add']);_.bindAll(this,['removeFileRow']);_.bindAll(this,['remove']);this.collection.bind('add',this.add);this.collection.bind('remove',this.remove);},add:function(model,models,options){var fileAvailable;if(document.lockifyUserEntryDefaults!==undefined){fileAvailable=document.lockifyUserEntryDefaults.attributes.allow_files;}else if(uu!==undefined){fileAvailable=uu.get('allowFiles');}else{fileAvailable=false;}
if(fileAvailable){var args={r:{cclass:"fileRow cf"},c1:{cclass:"fileNameCell",text:model.get('filename')},c2:{cclass:"fileSizeCell",text:model.get('displaySize')},l1:{cclass:"fileLinkCell icon-cancel-2 icomoon-icon small",text:"",func:this.removeFileRow}};$("#dataContainer").addClass("fileAdded");if(lockifyIndexGlobals.maxFilesPerLink==1){$("#incFileIcon").hide();}
this.insertGenRow(args,$(".fileRowContainer"));$(".saveFileMetadataContainer label").removeClass('disabled');$('#saveFileMetadata').prop('disabled',false);}},insertGenRow:function(args,container,slide){if(typeof(slide)=='undefined'){slide=true;}
var row=$("<div>");row.addClass(args.r.cclass);var nameCell=$("<div>");nameCell.addClass(args.c1.cclass);nameCell.append($("<span>").text(args.c1.text));var sizeCell=$("<div>");sizeCell.addClass(args.c2.cclass).text(args.c2.text);var linkCell=$("<div tabindex='0'>");linkCell.addClass(args.l1.cclass).text(args.l1.text).click(args.l1.func).bind('keyup',fileLinkKeyupHandler).focus(fileLinkFocusHandler).blur(fileLinkBlurHandler);if(args.l1.tooltip!==undefined){linkCell.attr('title',args.l1.tooltip);}
row.append(linkCell).append(nameCell).append(sizeCell).hide();container.append(row);$('.fileRow').first().addClass('first');if($('#addedDocsDiv').is(':visible')){setTimeout(function(){row.slideDown(1000);},100);}else{row.show();}
this.trigger('listUpdated',this.fileCount());if(this.fileCount()>1){$('.dynamicFileText').text($('.dynamicFileText').data('multiple'));}else{$('.dynamicFileText').text($('.dynamicFileText').data('single'));}
var textSpan=nameCell.find('span:last');if(typeof textSpan.attr('title')!='undefined'){lockifyUtils.setupQtips(textSpan,{my:'bottom left',at:'top left'});}
setTimeout(function(){$("#addedDocsDiv").slideDown(1000);},100);},remove:function(model,models,options){$(".fileRow").eq(options.index).slideUp(500,function(){$(this).remove();$(document).trigger('fileRemoved');});if(this.fileCount()>1){$('.dynamicFileText').text($('.dynamicFileText').data('multiple'));}else{$('.dynamicFileText').text($('.dynamicFileText').data('single'));}},removeFileRow:function(event){var fileIndex=$("#addedDocsDiv .fileRow").index($(event.currentTarget).parent());this.collection.remove(this.collection.at(fileIndex));},fileCount:function(){return $('.fileRowContainer > .fileRow').length;}});