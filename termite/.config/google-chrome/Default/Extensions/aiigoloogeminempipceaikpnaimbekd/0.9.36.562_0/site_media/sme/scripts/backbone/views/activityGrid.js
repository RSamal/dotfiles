var HtmlCell=Backgrid.HtmlCell=Backgrid.StringCell.extend({render:function(){this.$el.empty();var model=this.model;this.$el.html(this.formatter.fromRaw(model.get(this.column.get("name")),model));this.delegateEvents();return this;}});var MultilineHtmlCell=Backgrid.MultilineHtmlCell=HtmlCell.extend({formatter:_.extend({},Backgrid.CellFormatter.prototype,{fromRaw:function(rawValue,model){return rawValue.replace(/\n/g,'<br/>');}})});var ActivityGridView=Backbone.View.extend({initialize:function(options){this.options=$.extend({},this.defaults,options||{});defaultSortFunc=function(model,sortKey){return model.get(sortKey).toLowerCase();};var columns=[{name:"time_display",label:"Time",sortValue:function(model,sortKey){return model.get('time_sort').toLowerCase();},editable:false,cell:Backgrid.MultilineHtmlCell.extend({className:"timeCell doubleLine string-cell"})},{name:"user",label:"Acting User",sortValue:defaultSortFunc,editable:false,cell:Backgrid.MultilineHtmlCell.extend({className:"userCell doubleLine string-cell"})},{name:"action",label:"Action",sortValue:defaultSortFunc,editable:false,cell:Backgrid.MultilineHtmlCell.extend({className:"actionCell string-cell"})}];this.grid=new Backgrid.Grid({columns:columns,collection:this.collection});$('#activityGrid').append(this.grid.render().$el);this.collection.fetch({reset:true}).then(_.bind(this.handleGridLoad,this));},handleGridLoad:function(){this.grid.header.row.cells[0].$('a').click();this.grid.header.row.cells[0].$('a').click();lockifyUtils.hideLoadingCover();}});