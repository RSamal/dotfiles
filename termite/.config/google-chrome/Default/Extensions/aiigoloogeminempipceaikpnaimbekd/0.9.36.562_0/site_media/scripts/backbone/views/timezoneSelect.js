var TimezoneSelectView=Backbone.View.extend({events:{"change input[name='toggleTimezones']":"handleTimezoneToggle"},initialize:function(options){this.options=$.extend({},this.defaults,options||{});if(typeof this.options.allTimezones=='undefined'){this.options.allTimezones=new AllTimezones();}
if(typeof this.options.favoredTimezones=='undefined'){var modelInitObj={};if(this.model.get('timezone')){modelInitObj={include_tz:this.model.get('timezone')};}
this.options.favoredTimezones=new FavoredTimezones(modelInitObj);}
this.options.activeTimezones=this.options.favoredTimezones;this.$('.customSelectList li').each(function(index,elem){$(this).text($(this).text().replace(/_/g,' '));});this.tzoneDropDown=this.$('.customSelectContainer').imageDropdown({'selectList':this.$(".customSelectList"),'highlightClass':'li-hover'});_.bindAll(this,['updateTimezoneOptions']);this.options.activeTimezones.fetch().then(this.updateTimezoneOptions);_.bindAll(this,['handleChange']);this.tzoneDropDown.bind('change',this.handleChange);},val:function(){return this.tzoneDropDown.val();},close:function(){return this.tzoneDropDown.close();},disable:function(){return this.tzoneDropDown.disable();},enable:function(){return this.tzoneDropDown.enable();},getSelectedOption:function(){return this.tzoneDropDown.getSelectedOption();},setSelectedValue:function(val){return this.tzoneDropDown.setSelectedValue(val);},handleChange:function(event){this.trigger('change');},handleTimezoneToggle:function(event){var isChecked=$(event.target).is(':checked');this.options.activeTimezones=isChecked?this.options.allTimezones:this.options.favoredTimezones;if(this.options.activeTimezones===this.options.favoredTimezones||this.options.activeTimezones.models.length==0){this.options.activeTimezones.fetch().then(this.updateTimezoneOptions);}else{this.updateTimezoneOptions();}},updateTimezoneOptions:function(){this.$(".customSelectList").empty();var self=this;$.each(this.options.activeTimezones.models,function(i,val){if(val.get('disabled')){var pat='<li data-disabled="true">'+val.get('displayname')+'</li>';}else{var pat='<li data-value="'+val.get('name')+'"><span>GMT '+val.get('utcoffset')+' '+val.get('displayname')+val.get('displayname2')+'</span></li>';}
self.$(".customSelectList").append($(pat));});this.tzoneDropDown.bindOptionClick();this.tzoneDropDown.unbind('change',this.handleChange);this.tzoneDropDown.setSelectedValue(this.model.get('timezone'));this.tzoneDropDown.bind('change',this.handleChange);},displayInlineMessage:function(msg){lockifyUtils.displayUpdateResultDialog(msg);}});