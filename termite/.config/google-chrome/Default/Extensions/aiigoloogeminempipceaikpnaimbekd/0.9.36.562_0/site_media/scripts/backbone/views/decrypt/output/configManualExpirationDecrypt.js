var ConfigManualExpirationDecryptView=BaseDecryptOutputView.extend({initialize:function(){this.on('configExpirationMessage',this.configExpirationMessage);this.on('configManualExpire',this.configManualExpire);$('.confirmDestination').waitButton();},configExpirationMessage:function(json){if(json.is_expired||json.remaining_views===0||json.remaining_time===""){$('.justExpired').show();setTimeout(function(){lockifyUtils.cssFadeIn('.noticeText');},200);$('#exitPageDialog .expired').removeClass('defaultHide').show();$('#exitPageDialog .regular').hide();$('#remainingViewsContainer').hide();$("#divSuccess").addClass('expired');$("#expireLinkDialog").bind('dialogclose',function(event){$("#successExpireDialog").dialog($.extend({},dialogOptions,{modal:false,dialogClass:'blip'}));setTimeout(function(){$("#successExpireDialog").dialog('close');$("#expireLinkDialog").unbind('dialogclose');},2500);});$('#fileWarning').find('.last').toggleClass('defaultHide');lockifyUtils.setOnBeforeUnloadMsg("This Lockify Link has expired. You will not be able to view it again.");}else{$('#remainingViewsVal').text(json.remaining_views);$('#remainingViewsVal').next('span').pluralize({'value':json.remaining_views});$('.justExpired').hide();$('#remainingTimeDesc').html(lockifyUtils.splitValueIntoSpans(json.remaining_time));$('#remainingViewsContainer').show();lockifyUtils.setOnBeforeUnloadMsg("You may not be able to view this Lockify Link again.\n\nTo check viewings/time remaining, stay on this page and click the small circular arrow icon.");}
$("a:not(.noExitLink)").click(function(){var obuHandler=null;if(lockifyUtils.isOnBeforeUnloadMsgSet()){obuHandler=window.onbeforeunload;}
lockifyUtils.setOnBeforeUnloadMsg(null);var destinationURL=$(this).attr('href');$(".confirmDestination").click(function(){window.location=destinationURL;});$("#exitPageDialog").dialog($.extend({},dialogOptions,{close:function(e){if($(e.currentTarget)!==$("#confirmDesitination")){lockifyUtils.setOnBeforeUnloadMsg(obuHandler);}}}));return false;});},configManualExpire:function(allow_manual_expiration,remaining_views,expire_auth_token){if(allow_manual_expiration&&remaining_views>0){$("#manualExpireLink").bind('keyup','return',function(){$("#manualExpireLink").click();});var self=this;$("#manualExpireLink").click(function(){$("#expireLinkDialog").dialog(dialogOptions);$("#btnExpireLinkNow").blur();$("#btnExpireLinkNow").click(function(){$("#btnExpireLinkNow").addClass('loading');lockifyAjax.ajaxJSONSafe("/entry/delete","d="+lockify.gateway.dataHash+"&t="+expire_auth_token,function(json){if(json.success){$("#expireLinkDialog").dialog('close');self.configExpirationMessage({'is_expired':true});}else{$("#expireLinkDialog").dialog('close');alert("Expiration Failed: "+json.Reason);}},null);});});}else{$("#manualExpireLink").remove();}}});