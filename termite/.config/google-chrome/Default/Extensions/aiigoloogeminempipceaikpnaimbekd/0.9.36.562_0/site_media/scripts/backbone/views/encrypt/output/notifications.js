var NotificationsView=Backbone.View.extend({defaults:{"saveOnChange":true},events:{"change #notify":"handleChange","click #notifyDefault":"handleDefaultClick"},initialize:function(options){this.options=$.extend({},this.defaults,options);$(document).bind('formBoundToUserPrefs',this.updateElements);_.bindAll(this,['handleNewLinkUiPopulated']);$(document).bind('newLinkUiPopulated',this.handleNewLinkUiPopulated);_.bindAll(this,['handleMigrateToSignedOn']);$(document).bind('migrateToSignedOn',this.handleMigrateToSignedOn);_.bindAll(this,['reset']);$(document).bind('formReset',this.reset);},updateElements:function(){$('#notify').change();},handleChange:function(event){this.model.set({receiveNotifications:$('#notify').length?!$('#notify').is(':checked'):null});if(this.options.saveOnChange){var pickedFields=_.pick(this.model.attributes,'dataHash','receiveNotifications','publicId');pickedFields.adminCredHash=this.model.get("cryptoAssets")["adminCredHash"];this.model.save(pickedFields,{patch:true,success:function(model,json){var callback;if(json.equalsDefault===false){callback=function(){};}else{lockifyUtils.cssFadeOut('#notifyDefault');}
if(json.success){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg,callback);if(typeof document.lockifyUserEntryDefaults!='undefined'&&document.lockifyUserEntryDefaults.get('receiveNotifications')==$('#notify').is(':checked')){lockifyUtils.cssFadeIn('#notifyDefault');}}else{alert("Change Failed: "+json.Reason);}},error:null});}else{if(typeof document.lockifyUserEntryDefaults!='undefined'&&document.lockifyUserEntryDefaults.get('receiveNotifications')==$('#notify').is(':checked')){lockifyUtils.cssFadeIn('#notifyDefault');}else{lockifyUtils.cssFadeOut('#notifyDefault');}}
$(document).bind('linkExpired',this.handleLinkExpiration);},handleDefaultClick:function(event){var defaults=document.lockifyUserEntryDefaults;defaults.set('receiveNotifications',!$('#notify').is(':checked'));defaults.save(_.pick(defaults.attributes,'receiveNotifications'),{patch:true,success:function(){lockifyUtils.cssFadeOut('#notifyDefault');lockifyUtils.displayUpdateResultDialog(lockifyGlobals.defaultSavedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});},handleNewLinkUiPopulated:function(){this.options.saveOnChange=true;},handleMigrateToSignedOn:function(){if(this.model.get('receiveNotifications')!=document.lockifyUserEntryDefaults.get('receiveNotifications')){lockifyUtils.cssFadeIn('#notifyDefault');}},handleLinkExpiration:function(){$("#notifyContainer").hide();},reset:function(){}});