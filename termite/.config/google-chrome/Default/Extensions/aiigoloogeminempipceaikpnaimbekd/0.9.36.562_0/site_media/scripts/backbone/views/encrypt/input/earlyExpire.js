var EarlyExpireView=Backbone.View.extend({defaults:{"saveOnChange":true,"useSaveDefault":false,"doDefaultCheck":false},events:{"change #allowExpire":"handleChange","click #allowExpireDefault":"handleDefaultClick"},initialize:function(options){this.options=$.extend({},this.defaults,options||{});if(this.options.doDefaultCheck){var tmp=this.options.saveOnChange;$('#allowExpire').prop('checked',this.model.get('allowManualExpiration'));this.options.saveOnChange=tmp;if(this.model.get('allowManualExpiration')!=document.lockifyUserEntryDefaults.get('allowManualExpiration')){lockifyUtils.cssFadeIn('#allowExpireDefault');}}
$(document).bind('formBoundToUserPrefs',this.updateElements);_.bindAll(this,['handleNewLinkUiPopulated']);$(document).bind('newLinkUiPopulated',this.handleNewLinkUiPopulated);_.bindAll(this,['reset']);$(document).bind('formReset',this.reset);},updateElements:function(){$('#allowExpire').change();},handleChange:function(){this.model.set({allowManualExpiration:$('#allowExpire').length?$('#allowExpire').is(":checked"):null});var self=this;if(this.options.saveOnChange){var pickedFields=_.pick(this.model.attributes,'dataHash','allowManualExpiration','publicId');pickedFields.adminCredHash=this.model.get("cryptoAssets")["adminCredHash"];this.model.save(pickedFields,{patch:true,success:function(model,json){var callback;if(json.equalsDefault===false){callback=function(){};}else{lockifyUtils.cssFadeOut('#allowExpireDefault');}
if(json.success){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg,callback);if(typeof document.lockifyUserEntryDefaults!='undefined'&&document.lockifyUserEntryDefaults.get('allowManualExpiration')!=$('#allowExpire').is(':checked')){lockifyUtils.cssFadeIn('#allowExpireDefault');}}else{alert("Change Failed: "+json.Reason);}},error:null});}else{this.trigger('change');}},handleDefaultClick:function(event){var defaults=document.lockifyUserEntryDefaults;defaults.set('allowManualExpiration',$('#allowExpire').is(':checked'));defaults.save(_.pick(defaults.attributes,'allowManualExpiration'),{patch:true,success:function(){lockifyUtils.cssFadeOut('#allowExpireDefault');lockifyUtils.displayUpdateResultDialog(lockifyGlobals.defaultSavedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});},handleNewLinkUiPopulated:function(){this.options.saveOnChange=true;this.options.useSaveDefault=true;if(this.model.get('allowManualExpiration')!=document.lockifyUserEntryDefaults.get('allowManualExpiration')){lockifyUtils.cssFadeIn('#allowExpireDefault');}},reset:function(){}});