var TestEncryptionManualView=Backbone.View.extend({initialize:function(){this.bind('showEncryptUI',this.showEncryptUI);},events:{"click #encrypt":"showEncryptUI","keyup #data":"dataKeyUp","click #encrypt .cryptReset":"handleClickReset","click .cryptButton":"handleManualEncrypt","click #encryptReset":"handleClickReset","click #encryptTab":"handleClickReset"},showEncryptUI:function(){$('#encrypt').show();$('#decrypt').hide();$('#setup').hide();$("#encryptTab").addClass("active");$("#setupTab").removeClass("active");$("#decryptTab").removeClass("active");},dataKeyUp:function(){if($('#data').val()===''){$("#encryptButton").prop('disabled',true).addClass("disabled");}else{if(!$('#data').is('[readonly]')){$("#encryptButton").prop('disabled',false).removeClass("disabled");}}},handleClickReset:function(){$('#encryptReset').hide();$("#encrypt .section:not(.default) .sectionHeader").hide();$("#encrypt .section:not(.default) .stepContent").hide();$("#encryptOutput").hide();$("#data").attr('readonly',false).val('').focus();$("#encrypt3").show();$('.stepResult').hide();},handleManualEncrypt:function(){function gatherEncryptInputData(){var message=$('#data').val()+"\n";return new EntryModel({'bitStrength':256,'passphrase':$('#encrypt_passphrase').text(),'plaintext':message});}
var data=gatherEncryptInputData();if(!lockifyCryptoUtils.nativeCryptoAvailable()&&!Random.is_ready()){return false;}
lockify.sjclBridge.encrypt.encryptData(data,'encryptMessage',function(result){$('#encryptReset').removeClass("disabled").removeAttr("disabled").show();$("#encryptButton").addClass("disabled").prop('disabled',true);$("#data").attr('readonly',true);$("#encryptOutput").show();$("#encrypt .sectionHeader").show();$("#encrypt .stepContent").show();$('#ciphertext_output').text($.trim(result.ciphertext).slice(0,-46).replace(/\n/g,'\\n')).parent().show();$('#encrypt_passphrase').text(result.keyString);$('#encrypt_hmac').text($.trim(result.ciphertext).slice(-44).replace(/\n/g,'\\n'));$("#encrypt3").hide();$('.stepResult').removeClass('defaultHide');$('#encrypt_command_ciphertext').text($.trim(result.ciphertext).slice(0,-46).replace(/\n/g,'\\n'));$('#encrypt_command_hmac').text($.trim(result.ciphertext).slice(-44).replace(/\n/g,'\\n'));$('#encrypt_command_key').text($.trim(result.keyString));$("#entropyDialog").dialog('close');$('body').css('cursor','default');});return false;}});