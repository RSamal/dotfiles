var RegistrationView=Backbone.View.extend({defaults:{},events:{"submit #registration_form":"handleRegistrationFormSubmit","click #regResetLink":"handleResetClick"},initialize:function(options){this.options=$.extend({},this.defaults,options||{});if($('#registerTzoneSelect').length){this.registerTzoneDropDown=$('#registerTzoneSelect').imageDropdown({'selectList':$("#registerTzoneSelect_options"),'initialvalue':$("#registerTzoneSelect_options").data('initialValue'),'highlightClass':'li-hover'});}
_.bindAll(this,['handleRegistrationCompleteCheck']);},handleRegistrationFormSubmit:function(e){var self=this;$('#registration_form').find('input').removeClass('validationError');lockifyAjax.ajaxJSONSafeForm("/register/json/",$(e.currentTarget),function(json){$('#registration_form').hide();$("#registerPanel .sectionHeader").hide();$('#registrationSubmitted').show();$('#loginExtraInfo').hide();$('#expressUtilityPanels .claimLinkRegister').show();$('.registerEmailAddress').text($('#reg_email').val());if($("#expressUtilityPanels").is(":visible")){$("#expressUtilityPanels .dialogFooter").hide();$("#expressUtilityPanels .dialogContent").addClass("footerless");$(".dynamicText").text($('.dynamicText').data('checkemail'));}
var publicIdField=$(e.currentTarget).children('input[name=publicId]').eq(0);var adminCredHashField=$(e.currentTarget).children('input[name=adminCredHash]').eq(0);if(publicIdField.length&&adminCredHashField.length){var dataStr="publicId="+publicIdField.val()+"&adminCredHash="+adminCredHashField.val();setTimeout(self.handleRegistrationCompleteCheck,30000,[dataStr]);}else{$("#expressUtilityPanels .claimLinkRegister").hide();}},function(json){$.each((json&&json.field_errors)||[],function(name,val){$('#reg_'+name).addClass('validationError');});$("#registerButton").trigger('deanimate');if(json&&json.field_errors&&json.field_errors['email']&&json.field_errors['email'][0].indexOf('in use')!=-1){}});return false;},handleRegistrationCompleteCheck:function(dataStr){var self=this;lockifyAjax.ajaxJSONSafe('/register/confirm/check/',dataStr,function(json){if(json.result){$('.utilityLinks').hide();$('.nonauthenticatedUserOnly').hide();$('.authenticatedUserOnly').show();$('#siteTagline').hide();$('#navBar').css('margin-top','25px');$("#expressUtilityPanels").dialog('close');$('body').removeClass('guestUser').removeClass('express');$('.usernameLabel').text(json.username);if(typeof userDropdownView!='undefined'){new userDropdownView({el:$('#userDropdown'),model:null,username:json.username});}}else{setTimeout(self.handleRegistrationCompleteCheck,5000,[dataStr]);}});},handleResetClick:function(e){$('#pwordResetPanel #id_email').val($(e.currentTarget).children('span').eq(0).text());$('#reset_password_form').submit();$('.showPwordPanel').click();}});