var EntryDefaultsView=Backbone.View.extend({defaultAuthDropDown:null,events:{"change #id_enableCopy":"handleEnableCopyChange","change #id_enablePrint":"handleEnablePrintChange","change #id_enableExpire":"handleEnableExpireChange","change #id_decryptWithWebApp":"handleDecryptWithWebApp","change #id_notify":"handleNotifyChange","change #id_flashCopyCheckbox":"handleEnableFlashCopy","change #id_shortLinkCheckbox":"handleEnableShortLink","change #id_saveFileMetaData":"handleSaveFileMetaData"},initialize:function(options){this.viewsAndTime=new ViewsAndTimeView({el:$('#maxViewsSelect_outter').parent(),model:options.model});this.viewsAndTime.model.bind('change:maxViews',this.handleMaxViewsChange);this.viewsAndTime.model.bind('change:lifeMinutes',this.handleLifeMinutesChange);this.authMethodDropDown=$('#defaultAuthSelect').imageDropdown({'selectList':$("#defaultAuthSelect_options"),'initialvalue':this.model.get('auth_method'),'highlightClass':'li-hover'});_.bindAll(this,['handleAuthMethodChange']);if(this.authMethodDropDown){this.authMethodDropDown.bind('change',this.handleAuthMethodChange);}
this.model.bind("change:enable_message_copying",this.updateEnableMessageCopying);this.model.trigger("change:enable_message_copying");this.model.bind("change:enable_message_printing",this.updateEnableMessagePrinting);this.model.trigger("change:enable_message_printing");this.model.bind("change:allowManualExpiration",this.updateEnableManualExpiration);this.model.trigger("change:allowManualExpiration");this.model.bind("change:decryptWithWebApp",this.updateDecryptWithWebApp);this.model.trigger("change:decryptWithWebApp");this.model.bind("change:receiveNotifications",this.updateNotifyChange);this.model.trigger("change:receiveNotifications");this.model.bind("change:enableFlashCopy",this.updateEnableFlashCopy);this.model.trigger("change:enableFlashCopy");this.model.bind("change:enableStrongLink",this.updateEnableShortLink);this.model.trigger("change:enableStrongLink");this.model.bind("change:saveFileMetaData",this.updateSaveFileMetaData);this.model.trigger("change:saveFileMetaData");},updateEnableMessageCopying:function(){if(this.get('enable_message_copying')){$('#id_enableCopy').prop('checked',false);}else{$('#id_enableCopy').prop('checked',true);}},handleEnableCopyChange:function(event){var elem=$(event.target);var sibling=$('label[for="'+elem.attr('id')+'"]');this.model.save({enable_message_copying:!elem.is(":checked")},{success:function(){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});},updateEnableMessagePrinting:function(){if(this.get('enable_message_printing')){$('#id_enablePrint').prop('checked',false);}else{$('#id_enablePrint').prop('checked',true);}},handleEnablePrintChange:function(event){var elem=$(event.target);var sibling=$('label[for="'+elem.attr('id')+'"]');this.model.save({enable_message_printing:!elem.is(":checked")},{success:function(){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});},updateEnableManualExpiration:function(){if(this.get('allowManualExpiration')){$('#id_enableExpire').prop('checked',true);}else{$('#id_enableExpire').prop('checked',false);}},handleEnableExpireChange:function(event){var elem=$(event.target);var sibling=$('label[for="'+elem.attr('id')+'"]');this.model.save({allowManualExpiration:elem.is(":checked")},{success:function(){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});},updateDecryptWithWebApp:function(){if(this.get('decryptWithWebApp')){$('#id_decryptWithWebApp').prop('checked',false);}else{$('#id_decryptWithWebApp').prop('checked',true);}},handleDecryptWithWebApp:function(event){var elem=$(event.target);var sibling=$('label[for="'+elem.attr('id')+'"]');this.model.save({decryptWithWebApp:!elem.is(":checked")},{success:function(){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});},updateNotifyChange:function(){if(this.get('receiveNotifications')){$('#id_notify').prop('checked',false);}else{$('#id_notify').prop('checked',true);}},handleNotifyChange:function(event){var elem=$(event.target);var sibling=$('label[for="'+elem.attr('id')+'"]');this.model.save({receiveNotifications:!elem.is(":checked")},{success:function(){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});},handleMaxViewsChange:function(event){if(this.hasChanged("maxViews")){var elem=$('#viewingsSelect');this.save({},{success:function(){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});}},handleLifeMinutesChange:function(event){if(this.hasChanged("lifeMinutes")){var elem=$('#timerSelect');this.save({},{success:function(){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});}},handleAuthMethodChange:function(){if(this.authMethodDropDown){var elem=$('#defaultAuthSelect');this.model.save({auth_method:this.authMethodDropDown.val()},{success:function(){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});}},updateEnableFlashCopy:function(){if(this.get('enableFlashCopy')){$('#id_flashCopyCheckbox').prop('checked',false);}else{$('#id_flashCopyCheckbox').prop('checked',true);}},handleEnableFlashCopy:function(event){var elem=$(event.target);var sibling=$('label[for="'+elem.attr('id')+'"]');this.model.set('enableFlashCopy',!elem.is(":checked"));this.model.save(_.pick(this.model.attributes,'enableFlashCopy'),{patch:true,success:function(){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});},updateEnableShortLink:function(){if(this.get('bit_strength')==128){$('#id_shortLinkCheckbox').prop('checked',true);}else{$('#id_shortLinkCheckbox').prop('checked',false);}},handleEnableShortLink:function(event){var elem=$(event.target);var sibling=$('label[for="'+elem.attr('id')+'"]');this.model.set('bit_strength',elem.is(":checked")?128:256);this.model.save(_.pick(this.model.attributes,'bit_strength'),{patch:true,success:function(){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});},updateSaveFileMetaData:function(){if(this.get('save_file_metadata')){$('#id_saveFileMetaData').prop('checked',false);}else{$('#id_saveFileMetaData').prop('checked',true);}},handleSaveFileMetaData:function(event){var elem=$(event.target);var sibling=$('label[for="'+elem.attr('id')+'"]');this.model.set('save_file_metadata',!elem.is(":checked"));this.model.save(_.pick(this.model.attributes,'save_file_metadata'),{patch:true,success:function(){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});},});