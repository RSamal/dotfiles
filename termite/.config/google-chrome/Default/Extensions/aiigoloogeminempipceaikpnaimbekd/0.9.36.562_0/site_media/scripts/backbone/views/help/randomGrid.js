var RandomGridView=Backbone.View.extend({defaults:{gridDim:256,cellDim:2,compression:1,totalRuns:64},initialize:function(options){this.options=$.extend({},this.defaults,options||{});_.bindAll(this,'plotPoint','plotPoints','populateGrid','handleCancel');$(document).bind('prngTestCancel',this.handleCancel);},_intv:null,handleCancel:function(){clearInterval(this._intv);},render:function(){clearInterval(this._intv);this.$el.children().remove();var canvas=document.createElement('canvas');canvas.width=this.options.gridDim*this.options.cellDim/this.options.compression;canvas.height=this.options.gridDim*this.options.cellDim/this.options.compression;this.$el.append(canvas);var ctx=this.options.ctx=canvas.getContext('2d');ctx.fillStyle="#FFFFFF";ctx.fillRect(0,0,canvas.width,canvas.height);this.options.arrSize=this.options.gridDim*this.options.gridDim/this.options.compression;ctx.fillStyle="rgba(28, 59, 103, 0.2)";return this;},plotPoint:function(x,y){this.options.ctx.fillRect(Math.floor(x/this.options.compression)*this.options.cellDim,Math.floor(y/this.options.compression)*this.options.cellDim,this.options.cellDim,this.options.cellDim);},plotPoints:function(ba){this.plotPoint(ba[0],ba[1]);this.plotPoint(ba[2],ba[3]);},populateGrid:function(event,forceNonNative){var self=this;var randInts=null;var i=0;var j=0;this._intv=setInterval(function(){if(i>=self.options.totalRuns){clearInterval(self._intv);$(document).trigger('randomGridComplete');}
if(!randInts){randInts=lockifyCryptoUtils.getRandomWords(self.options.arrSize/512,false,forceNonNative);$(document).trigger('gotRandomWords',randInts.length*4);self.options.chi2sGraph.model.pushVal(chiSquare.calculate(sjcl.codec.bytes.fromBits(randInts)));$(document).trigger('chi2Ready',i);if(typeof console!='undefined')console.log(i+++" done");j=0;return;}
if(j>=randInts.length){randInts=null;return;}
self.plotPoints(sjcl.codec.bytes.fromBits([randInts[j++]]));},0);}});