var FileDecryptView=BaseDecryptInputView.extend({initialize:function(options){self.bind('displayFilesToSave',self.displayFilesToSave);},firstRowClass:function(){$('.fileRow').first().addClass('first');},displayFilesToSave:function(files,callback){$("#saveDecFileContainer").addClass('html5');var self=this;this.displayFilesToSaveUsingFileApi(files,function(){callback();self.firstRowClass();});},displayFilesToSaveUsingFileApi:function(files,callback){var finishedFiles=0;$.each(files,function(i,fileData){if(false&&typeof chrome!='undefined'&&typeof chrome.fileSystem!='undefined'){var config={type:'saveFile',suggestedName:chosenFileEntry.name};chrome.fileSystem.chooseEntry(config,function(writableEntry){var blob=new Blob(new Uint8Array(fileData.readAsNumericByteArray()).buffer);writeFileEntry(writableEntry,blob,function(e){console.log('Write complete :');});});}else{window.webkitRequestFileSystem(TEMPORARY,5*1024*1024,function(fs){fs.root.getFile(fileData.filename,{create:true},function(fileEntry){var boo=function(e){console.log('Write complete.');var $row=$('<div class="fileRow"><div aria-hidden="true" class="icon-flag icomoon-icon"></div><div class="fileNameCell"><span></span></div><div class="fileSizeCell"></div><div class="fileLinkCell"><span class="fileLinkCellNoControls"></span></div></div>');$row.find('.fileNameCell span').text(fileEntry.name);$row.find('.fileSizeCell').text(lockifyUtils.formatFileSize(fileData.length));$link=$('<a target="_blank" class="noExitLink button fillGreen">').html('<span aria-hidden="true" class="icon-disk icomoon-icon small"></span> Save');$link.click(function(){var config={type:'saveFile',suggestedName:fileEntry.name};chrome.fileSystem.chooseEntry(config,function(writableEntry){if(typeof writableEntry!='undefined'){writableEntry.createWriter(function(writer){var blob=new Blob([new Uint8Array(fileData.readAsNumericByteArray()).buffer]);writer.seek(0);writer.write(blob);});}});});$row.find('.fileLinkCellNoControls').append($link);$('#fileList').append($row);if(++finishedFiles==files.length){callback();}};fileEntry.createWriter(function(fileWriter){fileWriter.onwriteend=boo;fileWriter.write(new Blob([]));});},function(e){var foo='bar';});},function(e){var foo=e;});}});},insertGenRow:function(args,container,slide){if(typeof(slide)=='undefined'){slide=true;}
row=$("<div>");row.addClass(args.r.cclass);nameCell=$("<div>");nameCell.addClass(args.c1.cclass);if(args.r.cclass=="fileRow"){nameCell.append($('<span>').addClass('icon-attachment').addClass('icomoon-icon'));}
nameCell.append($("<span>").text(args.c1.text));sizeCell=$("<div>");sizeCell.addClass(args.c2.cclass).text(args.c2.text);linkCell=$("<div class='fileLinkCell' tabindex='0'>");if(typeof(args.l1.html)!=='undefined'){linkCell.html(args.l1.html);}else{linkCell.addClass(args.l1.cclass).text(args.l1.text).click(args.l1.func).bind('keyup',fileLinkKeyupHandler).focus(fileLinkFocusHandler).blur(fileLinkBlurHandler);}
row.append(nameCell).append(sizeCell).append(linkCell);if(args.l1.tooltip!==undefined){row.append('<span class="defaultHide">'+args.l1.tooltip+'</span>');}
container.append(row);if(slide){row.slideUp(0).slideDown(500);}}});