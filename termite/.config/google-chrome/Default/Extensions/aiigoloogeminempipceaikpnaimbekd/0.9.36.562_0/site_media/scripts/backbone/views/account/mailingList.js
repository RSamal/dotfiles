var MailingListView=Backbone.View.extend({events:{"change input[type=checkbox]":"handleMailingListChanges"},initialize:function(options){this.options=$.extend({},this.defaults,options||{});this.populateMailingLists(this.options.response);},populateMailingLists:function(json){for(count=0;count<json.mlists.length;count++){var mlist=json.mlists[count];var p=$('<p>');var input=$('<input type="checkbox"></input>');input.attr('id','mailingList'+count);if(mlist['status']){input.prop('checked',true);}
var label=$('&nbsp;&nbsp;<label class="response uniformLabel"></label>');label.attr('for',input.attr('id'));label.html(mlist['name']);p.append(input);p.append(label);$('#mailingLists').append(p);}},handleMailingListChanges:function($this){$(document).css('cursor','disabled');var urls,msg;if(($this.target).checked){url='/account/list_subscribe/';msg="You are now subscribed.";}else{url='/account/list_unsubscribe/';msg="You have been unsubscribed.";}
url+=$('#mailingLists input[type=checkbox]').index($this.target);this.options.model.url=url;self=$this.target;this.options.model.fetch({success:function(model,response){$(document).css('cursor','');msgElem=$('<span>');var sibling=$('label[for="'+self.id+'"]');if(response===true){lockifyUtils.displayUpdateResultDialog(msg);}else{lockifyUtils.displayUpdateResultDialog("There was a problem. Please try again later.");}}});}});