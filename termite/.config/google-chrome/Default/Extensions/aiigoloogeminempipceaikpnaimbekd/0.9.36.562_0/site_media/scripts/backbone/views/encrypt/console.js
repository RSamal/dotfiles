var ConsoleView=Backbone.View.extend({events:{},initialize:function(options){this.options=$.extend({},this.defaults,options||{});$('.console.prng').text(lockifyCryptoUtils.nativeCryptoAvailable()?"Browser's Native PRNG":"JS Implementation of Fortuna");_.bindAll(this,"handleLinkCreated");$(document).bind('linkCreated',this.handleLinkCreated);$('#consoleContainer').scroll(function(){var scrollDist=$('#consoleContainer').scrollTop();if(scrollDist>13){scrollDist=13;}
$('.consoleHeader').css('box-shadow','0px 13px '+scrollDist+'px -13px rgba(0, 0, 0, 0.4)');});lockifyUtils.setupQtips('.tooltip-left',{my:'top right',at:'bottom right',adjust:{x:-20,y:-10}},{corner:'top right'});},handleLinkCreated:function(){var ca=lockify.index.entry.get('cryptoAssets');$('.console.iv').text(ca.iv);$('.console.salt').text(sjcl.codec.base64url.toBits(ca.salt));if(ca.key.toString().length<lockifyUtils.longValueLimit){$('.console.key').text(ca.key);}else{var ddv=new LongValueDialogView({el:$('.console.key'),model:lockify.index.entry,headerText:$('.console.key').parent().prev('.regularLabel').text(),valRaw:ca.key});ddv.render();}
$('.console.adminCredHash').text(ca.adminCredHash);var ct_hmac=ca.ciphertext;var ct=lockify.index.entry.getCipherText();if(ct.length<lockifyUtils.longValueLimit){$('.console.ciphertext').text(ct);}else{var ddv=new LongValueDialogView({el:$('.console.ciphertext'),model:lockify.index.entry,headerText:$('.console.ciphertext').parent().prev('.regularLabel').text(),valFunc:lockify.index.entry.getCipherText});ddv.render();}
$('.console.hmac').text(ct_hmac.substr(ct_hmac.length-44));if(ca.useridHashes.length){$('.console.useridHashes').text(ca.useridHashes).parent('li').removeClass('defaultHide');}
if(lockifyCryptoUtils.base64ToURLBase64(ct_hmac)<lockifyUtils.longValueLimit){$('.console.ciphertextBase64').text(lockifyCryptoUtils.base64ToURLBase64(ct_hmac));}else{var ddv=new LongValueDialogView({el:$('.console.ciphertextBase64'),model:lockify.index.entry,headerText:$('.console.ciphertextBase64').parent().prev('.regularLabel').text(),valFunc:lockify.index.entry.getCipherTextHmacUrlBase64});ddv.render();}
$('.console.keyHashBase64').text(lockifyCryptoUtils.base64ToURLBase64(lockify.index.entry.get('dataHash')));if(ca.useridHashes.length){$('.console.useridHashes').text(ca.useridHashes).parent('li').removeClass('defaultHide');}
$('.console.keyHash').text(ca.keyString);$('.console.views').text(lockify.index.entry.get('maxViews'));$('.console.minutes').text(lockify.index.entry.get('lifeMinutes'));$('.console.msgLength').text(lockifyUtils.numberWithCommas(lockify.index.entry.get('msgLength')));$('.console.publicId').text(lockify.index.entry.get('publicId'));$('.consoleToggles').removeClass('defaultHide');$('.initialNote').addClass('defaultHide');if($('#settingsToggle').children('.toggleTrigger').hasClass('open')){lockifyUtils.handleToggle($('#settingsToggle').children('.toggleTrigger'));}}});