var FlashFileReaderView=BaseFileReaderView.extend({defaults:{autoloadReader:false,varName:''},events:{"click #loadFileReader":"handleLoad","click #noFlashPluginMsg .fileBtn":"handleOpenNoDialog","click #wrongFlashPluginVersionMsg .fileBtn":"handleOpenWrongDialog"},initialize:function(options){_.bindAll(this,['gatherFiles']);this.options=$.extend({},this.defaults,options);if(this.options.autoloadReader){this.handleLoad();}
BaseFileReaderView.prototype.initialize.call(this);lockifyUtils.setupQtips('#flashFileReader',{my:'center left',at:'center right'});$('#flashFileReader').click(function(){$(this).qtip('hide');});},fileReader:function(){return document.getElementById("FlashLocalFileReader");},handleLoad:function(){var flashVars={onReadyFunction:this.options.varName+".flashOnReadyHandler",fileTooLargeFunction:this.options.varName+".fileTooLargeHandler",initHtmlFunction:this.options.varName+".createFlashButtonHtml",initCssFunction:this.options.varName+".createFlashButtonCss",loadCompleteFunction:this.options.varName+".addFile",tabOutFunction:this.options.varName+".flashBlurHandler"};var params={wmode:"transparent",allowScriptAccess:"always"};var attributes={id:"FlashLocalFileReader",align:"",bgcolor:"#FFFFFF",tabindex:0};swfobject.embedSWF(lockifyIndexGlobals.flashReaderFile,"loadFileReader","85","22","10.0.0","expressInstall.swf",flashVars,params,attributes,function(){try{$('#FlashLocalFileReader').focus();}catch(x){}
setTimeout(function(){$("#FlashLocalFileReader").css("display","inline-block");$("#incFileIcon").removeClass('loading');},1000);});this.updateAvailableFileUnits();},addFile:function(filename,numBytes){var file=new FileModel({filename:filename,numBytes:numBytes,displaySize:lockifyUtils.formatFileSize(numBytes)});this.collection.add(file);this.updateFlashWidth();BaseFileReaderView.prototype.addFile.call(this,filename,numBytes);},gatherFiles:function(){var self=this;return $.map(this.fileRefs().models,function(item,index){return{'filename':item.get('filename'),'size':item.get('numBytes'),'index':index,'reader':function(blockSize){return self.fileReader().readFileBytes(index,blockSize);}};});},createFlashButtonHtml:function(state){switch(state){case'addFirst':return'&nbsp;';case'addAdditional':return'&nbsp;';case'limitReached':return"&nbsp;";default:return null;}},createFlashButtonCss:function(state){var retArr=[];retArr.push("a {font-size: 15pt; color: #2980b9; font-family: Arial, Sans-Serif; text-decoration: none; line-height: 1 !important; margin: 0; padding: 0;");switch(state){case'up':break;case'over':retArr.push(" color: #226998;");break;case'disabled':retArr.push(" color: #9F9F9F;");break;}
retArr.push("}");return retArr.join('');},remove:function(model,models,options){this.fileReader().removeFileRef(options.index);BaseFileReaderView.prototype.remove.call(this,model,models,options);this.updateFlashWidth();if(lockifyIndexGlobals.maxFilesPerLink>1&&fileListView.fileCount()<=1){$("#addedDocsDiv").hide();$("#dataContainer").removeClass("fileAdded");$(".saveFileMetadataContainer label").addClass('disabled');$('#saveFileMetadata').prop('disabled',true);}},updateFlashWidth:function(){$(this.fileReader()).css('width','16px');},handleOpenNoDialog:function(){$('#noFlashDialog').dialog(dialogOptions);},handleOpenWrongDialog:function(){$('#wrongFlashDialog').dialog(dialogOptions);}});