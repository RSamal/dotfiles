var SpecifyDecryptClientView=Backbone.View.extend({defaults:{"saveOnChange":true},events:{"click #specifyClient":"handleSpecifyClientClick","click #specifyClientDefault":"handleDefaultClick"},initialize:function(options){this.options=$.extend({},this.defaults,options||{});_.bindAll(this,['updateElements']);$(document).bind('formBoundToUserPrefs',this.updateElements);_.bindAll(this,['handleNewLinkUiPopulated']);$(document).bind('newLinkUiPopulated',this.handleNewLinkUiPopulated);_.bindAll(this,['handleSpecifyClientChange']);_.bindAll(this,['reset']);$(document).bind('formReset',this.reset);},updateElements:function(){this.handleSpecifyClientChange();},handleSpecifyClientClick:function(){if(!$('#specifyClient').prop('checked')){$('#confirmDecryptClientDialog').dialog(dialogOptions);$('#confirmDecryptClientDialog #specifyEaseBtn').click(this.handleSpecifyClientChange);$('#confirmDecryptClientDialog #specifySecureBtn').click(this.handleEaseBtnClick);var self=this;$('#confirmDecryptClientDialog').on('dialogclose',function(){$('#confirmDecryptClientDialog #specifyEaseBtn').unbind('click',self.handleEasyBtnClick);$('#confirmDecryptClientDialog #specifySecureBtn').unbind('click',self.handleSpecifyClientChange);});}else{this.handleSpecifyClientChange();}},handleEaseBtnClick:function(){$('#specifyClient').prop('checked','checked');$('.dialogClose').click();},handleSpecifyClientChange:function(event){if(this.options.saveOnChange){lockifyAjax.ajaxJSONSafe('/admin/decryptclient/change/',"d="+lockify.index.entry.get('dataHash')+"&ap="+lockify.index.entry.get('cryptoAssets').adminCredHash+'&specifyDecryptClientType='+$('#specifyClient').is(':checked'),function(json){var callback;if(json.equalsDefault===false){callback=function(){};}else{lockifyUtils.cssFadeOut('#specifyClientDefault');}
if(json.success){lockifyUtils.displayUpdateResultDialog(lockifyGlobals.savedMsg);if(typeof document.lockifyUserEntryDefaults!='undefined'&&document.lockifyUserEntryDefaults.get('decryptWithWebApp')==!$('#specifyClient').is(':checked')){lockifyUtils.cssFadeIn('#specifyClientDefault');}}else{alert("Change Failed: "+json.Reason);}},null);}else{if(typeof document.lockifyUserEntryDefaults!='undefined'&&document.lockifyUserEntryDefaults.get('decryptWithWebApp')==$('#specifyClient').is(':checked')){lockifyUtils.cssFadeIn('#specifyClientDefault');}else{lockifyUtils.cssFadeOut('#specifyClientDefault');}}
this.model.set({specifyDecryptClientType:$('#specifyClient').length?$('#specifyClient').is(":checked"):null});},handleDefaultClick:function(event){var defaults=document.lockifyUserEntryDefaults;defaults.set('decryptWithWebApp',$('#specifyClient').is(':checked'));defaults.save(_.pick(defaults.attributes,'decryptWithWebApp'),{patch:true,success:function(){lockifyUtils.cssFadeOut('#specifyClientDefault');lockifyUtils.displayUpdateResultDialog(lockifyGlobals.defaultSavedMsg);},error:function(){lockifyUtils.displayUpdateResultDialog('Something went wrong. Please try again.');}});},handleNewLinkUiPopulated:function(){this.options.saveOnChange=true;},reset:function(){}});