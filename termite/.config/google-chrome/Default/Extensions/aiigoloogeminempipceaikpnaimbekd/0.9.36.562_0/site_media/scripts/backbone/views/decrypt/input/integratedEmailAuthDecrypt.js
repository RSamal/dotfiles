var IntegratedEmailAuthDecryptView=BaseDecryptInputView.extend({defaults:{checkUserIdWithServer:false},initialize:function(options){this.options=$.extend({},this.defaults,options);$('#authUis').addClass('auth_type_email');$('#authUi_integratedemail').show();$('#notYoursButtons').hide();$("#integratedEmailButton").hide();$('#emailMetaTips').show();$('#emailHeader').show();IntegratedEmailAuthDecryptView.__super__.finishInstructionText(this.options.json,this.options.authInfoKey,$('#validIntegratedEmails'));if(this.options.json.userids_aes256){$('#integratedemail').data('masks',lockify.sjclBridge.decrypt.decrypts(this.options.json.userids_aes256,this.options.authInfoKey));}
if($('#validIntegratedEmails').children().hasClass('multipleValueIds')){$('.status .multiple').show();$('.error .multiple').show();$('.error .one').hide();}
this.options.shortestMaskLength=_.reduce($('#integratedemail').data('masks').split(','),function(memo,value){if(value.length<memo){memo=value.length;}
return memo;},255);this.options.longestMaskLength=_.reduce($('#integratedemail').data('masks').split(','),function(memo,value){if(value.length>memo){memo=value.length;}
return memo;},0);this.model.on('change:isEmail',this.handleIsEmail,this);this.model.on('change:isNative',this.handleIsNative,this);this.model.on('change:isEmail change:isNative',this.handleNotFound,this);this.prevVal=null;},events:{"keyup #integratedemail":"handleEmailKeyUp","click #email_Button":"handleEmailClick","click #gmail_Button":"handleGmailClick","click #native_Button":"handleNativeClick"},handleEmailKeyUp:function(e){var el=$(e.currentTarget);if(el.val()===this.prevVal){return;}else{this.prevVal=el.val();}
var allow_partial=el.val().length<this.options.longestMaskLength;var matchIndex=lockifyUtils.matchesWhichMask(el.val(),el.data('masks').split(','),allow_partial);if(matchIndex>-1){$('#maskMismatchIntEmail').hide();if(el.val().length>=$.trim(el.data('masks').split(',')[matchIndex]).length){this.check_auth_type(el.val());}
else{this.model.set({'isEmail':null,'isNative':null});}}else{this.model.set({'isEmail':null,'isNative':null});$('#maskMismatchIntEmail').show();}
$('#getSecret').show().prop('disabled',false).removeClass('disabled');},handleEmailClick:function(){$('#email').val($('#integratedemail').val());$('#email_auth_button').removeClass('disabled').prop('disabled',false);if(!lockify.gateway.authEmailDecryptView){lockify.gateway.authEmailDecryptView=new AuthEmailDecryptView({el:$('#authUi_email'),json:this.options.json,auth_infoKey:this.options.authInfoKey,showOnStart:false});}
AuthEmailDecryptView.__super__.bind('otpRequestComplete',function(){$('#authUi_integratedemail').hide();});$('#back_email_button').show();$('#multiFactorInitiateEmail').hide();$('#multiFactorCode_email').show();$('#emailAuthMultiFactorCode').focus();$('.methodMetaTips').hide();lockify.gateway.authEmailDecryptView.trigger('handleClick');$('begin_openid_auth').hide();},handleGmailClick:function(){$('#authUi_integratedemail').hide();lockify.gateway.authGmailDecryptView=new AuthGmailDecryptView({el:$('#authUi_openid'),json:this.options.json,authkey:this.options.authInfoKey});authcomplete=lockify.gateway.authGmailDecryptView;lockify.gateway.authGmailDecryptView.trigger('configureOpenIDAuthLink');$('#back_gmail_button').show();$('#notYoursButtons').show();$('.methodMetaTips').hide();},handleNativeClick:function(){$('#authUi_integratedemail').hide();$('#id_username_la').val($('#integratedemail').val());$('.showNativeName').text($('#integratedemail').val());$('#validLockifyAccount').hide();$('.methodMetaTips').hide();$('#emailHeader').hide();authNativeDecryptView=new AuthNativeDecryptView({el:$('#authUi_lockifyUser'),json:this.options.json,authkey:this.options.authInfoKey,usernameReadOnly:true});$('#back_native_button').show();$('#getSecret').show().prop('disabled',false).removeClass('disabled');},check_auth_type:function(email){if(this.options.checkUserIdWithServer){this.model.set({'dh':lockify.gateway.dataHash,'email':email,'isEmail':null,'isNative':null},{'silent':true});this.model.fetch();}else{this.model.set({'dh':lockify.gateway.dataHash,'email':email,'isEmail':true,'isNative':true});}},handleIsEmail:function(model){$('#email_button').toggle(model.get('isEmail')===true);$('#gmail_button').toggle(model.get('isEmail')===true&&lockifyUtils.isGmail(model.get('email'))===true);},handleIsNative:function(model){$('#native_button').toggle(model.get('isNative')===true);},handleNotFound:function(model){var nativePrompt=$('#native_Button').is('span');var found=model.get('isEmail')===true||(model.get('isNative')===true&&nativePrompt);var notFound=model.get('isEmail')===false&&(model.get('isNative')===false||!nativePrompt);$("#integratedEmailButton").toggle(found);$("#integratedEmailNotFound").toggle(notFound);}});