var BaseFileReaderView=Backbone.View.extend({defaults:{maxFileKb:0,listView:null},initialize:function(){_.bindAll(this,['remove']);_.bindAll(this,['gatherFileMetadata']);this.collection.bind('remove',this.remove);this.updateAvailableFileUnits();},fileRefs:function(){return this.collection;},fileReader:function(){return null;},gatherFiles:function(){return[];},addFile:function(filename,numBytes){this.updateAvailableFileUnits();if(this.collection.length>=lockifyIndexGlobals.maxFilesPerLink){this.fileReader().disableButton();$("#flashFileReader").hide();$('.fileBtn').hide();$('#maxFilesAdded').removeClass('defaultHide');}
$(document).trigger('fileAdded');},updateAvailableFileUnits:function(){var sizeRemaining=Math.max(0,this.options.maxFileKb*1024
-this.collection.displayTotal());$(".availFileKb").text(lockifyUtils.formatFileSize(sizeRemaining,'floor'));},totalFileSize:function(){var i,sum=0,fileRefs=this.gatherFileMetadata();for(i=0;i<fileRefs.length;i++){sum+=fileRefs[i].size;}
return sum;},fileTooLargeHandler:function(numBytes,curBytes,newCount){if(newCount>1){$('.fileCount').text($('.fileCount').data('multifile'));}else{$('.fileCount').text($('.fileCount').data('singlefile'));}
$("#fileTooLargeDialog").dialog(dialogOptions);$(".fileKb").text(lockifyUtils.formatFileSize(numBytes));$(".maxFileKb").text(lockifyUtils.formatFileSize(this.options.maxFileKb*1024));if(curBytes){$('.curBytes').text(lockifyUtils.formatFileSize(curBytes));$('.gTotal').text(lockifyUtils.formatFileSize(curBytes+numBytes));if(this.collection.length>=2){$('.fileCountMulti').show();$('.fileCountSingle').hide();}else{$('.fileCountSingle').show();$('.fileCountMulti').hide();}
$('.prevBytes').show();}else{$('.prevBytes').hide();}
$('#html5FileReaderInput').val('');},tooManyFilesHandler:function(newCount,curTotal){$("#tooManyFilesDialog").dialog(dialogOptions);$(".newCount").text(newCount);$(".maxFileCount").text(lockifyIndexGlobals.maxFilesPerLink);if(curTotal){$('.curTotal').text(curTotal);$('.gTotal').text(curTotal+newCount);$('.prevCount').show();}else{$('.prevCount').hide();}
$('#html5FileReaderInput').val('');},clearFileRefs:function(){this.collection.reset();},remove:function(model,models,options){$('.fileBtn').show();$('#maxFilesAdded').addClass('defaultHide');$('#flashFileReader').show();this.updateAvailableFileUnits();this.fileReader().enableButton();$(document).trigger('fileRemoved');},gatherFileMetadata:function(){return $.map(this.collection.models,function(item,index){return{'filename':item.get('filename'),'size':item.get('numBytes'),'index':index};});}});