var PasteLinkView=Backbone.View.extend({defaults:{},events:{"click .button":"handleSubmit","keyup .llInput":"handleKeyup","reset":"handleReset"},initialize:function(options){this.options=$.extend({},this.defaults,options||{});this.options.defaultText=$('.llInput').val();var self=this;$(document).bind('userAuthComplete',function(e){setTimeout(function(){$('.llInput').focus();},1);if(top.decryptLink){self.$('.llInput').val(top.decryptLink);top.decryptLink=null;}});},handleReset:function(){$('.llInput').val('');$('.error').remove();},handleSubmit:function(event){$('.error').remove();if($('.llInput').hasClass('validationError')){$(".llInput").removeClass('validationError');}
var ll=$(this.el).find('.llInput').val();var hashPat="#([a-zA-Z0-9_-]+)[^a-zA-Z0-9_-]?.*$";var linkPat;if(lockifyGlobals.linkUrl.indexOf('localhost')!=-1){linkPat="[("+lockifyGlobals.linkUrl+")|"+lockifyGlobals.linkUrl.replace('localhost','127.0.0.1')+")]"+hashPat;}else{linkPat=lockifyGlobals.linkUrl+hashPat;}
var mm=ll.match(linkPat);if(mm){top.frames[0].location.replace("gateway.html#"+mm[1]);}else{$(".llInput").before($('<div class="error">This is not a valid Lockify Link. Please check your entry and try again.</div>'));$(".llInput").addClass('validationError');}},handleKeyup:function(event){if(event.keyCode==13){$(".button").click();}}});